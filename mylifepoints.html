<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis de Lifepoints</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 25px;
            margin-bottom: 30px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .summary {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        .summary-item {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 10px;
            flex: 1;
            min-width: 200px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .summary-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        .lifepoints {
            color: #3498db;
        }
        .euros {
            color: #27ae60;
        }
        .withdrawals {
            color: #e74c3c;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 30px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .highlight {
            background-color: #e8f4fd;
            font-weight: bold;
        }
        .schedule-analysis {
            margin-top: 40px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            margin-top: 20px;
        }
        .schedule-header {
            font-weight: bold;
            text-align: center;
            padding: 10px;
            background-color: #2c3e50;
            color: white;
        }
        .schedule-cell {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
            background-color: white;
        }
        .schedule-cell.high-activity {
            background-color: #2ecc71;
            color: white;
        }
        .schedule-cell.medium-activity {
            background-color: #f39c12;
            color: white;
        }
        .schedule-cell.low-activity {
            background-color: #e74c3c;
            color: white;
        }
        .schedule-cell.no-data {
            background-color: #ecf0f1;
        }
        .recommendations {
            margin-top: 30px;
            padding: 20px;
            background-color: #e8f4fd;
            border-radius: 8px;
        }
        .recommendation-item {
            margin-bottom: 15px;
            padding-left: 20px;
            position: relative;
        }
        .recommendation-item:before {
            content: "•";
            position: absolute;
            left: 0;
            color: #3498db;
            font-weight: bold;
        }
        @media (max-width: 768px) {
            .summary {
                flex-direction: column;
            }
            .summary-item {
                min-width: auto;
            }
            .chart-container {
                height: 300px;
            }
            .schedule-grid {
                grid-template-columns: repeat(4, 1fr);
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Análisis de Historial de Lifepoints</h1>
        
        <div class="summary">
            <div class="summary-item">
                <div>Lifepoints Ganados</div>
                <div class="summary-value lifepoints" id="total-lifepoints">0</div>
                <div>≈ <span id="total-euros">0</span> €</div>
            </div>
            <div class="summary-item">
                <div>Lifepoints Actuales</div>
                <div class="summary-value lifepoints" id="current-lifepoints">0</div>
                <div>≈ <span id="current-euros">0</span> €</div>
            </div>
            <div class="summary-item">
                <div>Retirados (PayPal)</div>
                <div class="summary-value withdrawals" id="withdrawn-lifepoints">0</div>
                <div>≈ <span id="withdrawn-euros">0</span> €</div>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="lifepointsChart"></canvas>
        </div>
        
        <h2>Resumen por Mes</h2>
        <table id="monthly-summary">
            <thead>
                <tr>
                    <th>Mes</th>
                    <th>Lifepoints Ganados</th>
                    <th>Valor Aprox. (€)</th>
                </tr>
            </thead>
            <tbody>
                <!-- Los datos se llenarán con JavaScript -->
            </tbody>
        </table>
        
        <div class="schedule-analysis">
            <h2>Análisis de Horarios de Encuestas</h2>
            <p>Basado en tu historial, estas son las horas y días con mayor probabilidad de encontrar encuestas:</p>
            
            <div class="schedule-grid" id="schedule-grid">
                <!-- Se generará con JavaScript -->
            </div>
            
            <div class="recommendations">
                <h3>Recomendaciones:</h3>
                <div id="recommendations-list">
                    <!-- Se generará con JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Función mejorada para convertir fechas en español a formato Date
        function parsearFecha(fechaStr) {
            // Mapeo completo de meses en español
            const meses = {
                'ene': 0, 'enero': 0,
                'feb': 1, 'febrero': 1,
                'mar': 2, 'marzo': 2,
                'abr': 3, 'abril': 3,
                'may': 4, 'mayo': 4,
                'jun': 5, 'junio': 5,
                'jul': 6, 'julio': 6,
                'ago': 7, 'agosto': 7,
                'sep': 8, 'sept': 8, 'septiembre': 8,
                'oct': 9, 'octubre': 9,
                'nov': 10, 'noviembre': 10,
                'dic': 11, 'diciembre': 11
            };
            
            // Limpiar y dividir la fecha
            const fechaLimpia = fechaStr.replace(',', '').toLowerCase();
            const partes = fechaLimpia.split(' ');
            
            // Encontrar día, mes y año
            let dia, mes, año, hora = 0, minutos = 0;
            
            for (let i = 0; i < partes.length; i++) {
                const parte = partes[i];
                // Buscar día (número)
                if (!isNaN(parte) && parte.length <= 2 && !dia) {
                    dia = parseInt(parte);
                }
                // Buscar mes (texto)
                else if (meses[parte] !== undefined && !mes) {
                    mes = meses[parte];
                }
                // Buscar año (número de 4 dígitos)
                else if (!isNaN(parte) && parte.length === 4 && !año) {
                    año = parseInt(parte);
                }
                // Buscar hora (formato hh:mm)
                else if (parte.includes(':')) {
                    const [h, m] = parte.split(':');
                    hora = parseInt(h);
                    minutos = parseInt(m);
                    
                    // Ajustar hora según formato AM/PM
                    if (i + 1 < partes.length) {
                        const siguienteParte = partes[i + 1];
                        if (siguienteParte === 'p.' || siguienteParte === 'p.m.') {
                            if (hora < 12) hora += 12;
                        } else if (siguienteParte === 'a.' || siguienteParte === 'a.m.') {
                            if (hora === 12) hora = 0;
                        }
                    }
                }
            }
            
            // Validar que tenemos todos los componentes
            if (dia && mes !== undefined && año) {
                return new Date(año, mes, dia, hora, minutos);
            } else {
                console.warn('Fecha no válida:', fechaStr, {dia, mes, año});
                // Retornar una fecha por defecto para evitar errores
                return new Date(2025, 0, 1);
            }
        }

        // Datos del historial con fechas parseadas
        const historial = [
            { fecha: parsearFecha("20 nov 2025, 8:21 a. m."), concepto: "Encuesta pagada", puntos: 65},
            { fecha: parsearFecha("19 nov 2025, 5:32 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("19 nov 2025, 3:13 p. m."), concepto: "Encuesta pagada", puntos: 65},
            { fecha: parsearFecha("19 nov 2025, 8:24 a. m."), concepto: "Encuesta pagada", puntos: 25},
            { fecha: parsearFecha("18 nov 2025, 3:17 p. m."), concepto: "Encuesta pagada", puntos: 90},
            { fecha: parsearFecha("18 nov 2025, 3:01 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("18 nov 2025, 2:23 p. m."), concepto: "Encuesta pagada", puntos: 65},
            { fecha: parsearFecha("17 nov 2025, 5:24 p. m."), concepto: "Encuesta pagada", puntos: 90},
            { fecha: parsearFecha("17 nov 2025, 3:23 p. m."), concepto: "PayPal", puntos: -575 },
            { fecha: parsearFecha("17 nov 2025, 3:23 p. m."), concepto: "Encuesta pagada", puntos: 90},
            { fecha: parsearFecha("17 nov 2025, 2:15 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("15 nov 2025, 12:05 p. m."), concepto: "Encuesta pagada", puntos: 40},
            { fecha: parsearFecha("14 nov 2025, 9:39 a. m."), concepto: "Encuesta pagada", puntos: 90},
            { fecha: parsearFecha("14 nov 2025, 12:33 a. m."), concepto: "Encuesta pagada", puntos: 65},
            { fecha: parsearFecha("13 nov 2025, 8:29 p. m."), concepto: "Encuesta pagada", puntos: 40},
            { fecha: parsearFecha("12 nov 2025, 5:07 p. m."), concepto: "Encuesta pagada", puntos: 90},
            { fecha: parsearFecha("12 nov 2025, 12:46 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("12 nov 2025, 12:09 p. m."), concepto: "Encuesta pagada", puntos: 90},
            { fecha: parsearFecha("11 nov 2025, 4:58 p. m."), concepto: "Encuesta pagada", puntos: 90},
            { fecha: parsearFecha("11 nov 2025, 2:36 p. m."), concepto: "PayPal", puntos: -575 },
            { fecha: parsearFecha("11 nov 2025, 2:36 a. m."), concepto: "Encuesta pagada", puntos: 65},
            { fecha: parsearFecha("11 nov 2025, 10:13 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("10 nov 2025, 11:00 p. m."), concepto: "Encuesta pagada", puntos: 140},
            { fecha: parsearFecha("10 nov 2025, 6:05 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("10 nov 2025, 5:50 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("10 nov 2025, 1:01 p. m."), concepto: "Encuesta pagada", puntos: 90},
            { fecha: parsearFecha("10 nov 2025, 12:31 p. m."), concepto: "Encuesta pagada", puntos: 65},
            { fecha: parsearFecha("10 nov 2025, 12:24 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 1 },
            { fecha: parsearFecha("5 nov 2025, 6:44 p. m."), concepto: "Encuesta pagada", puntos: 90},
            { fecha: parsearFecha("5 nov 2025, 5:56 p. m."), concepto: "Encuesta pagada", puntos: 1},
            { fecha: parsearFecha("5 nov 2025, 5:09 p. m."), concepto: "Encuesta pagada", puntos: 90},
            { fecha: parsearFecha("5 nov 2025, 4:07 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("5 nov 2025, 2:49 p. m."), concepto: "Encuesta pagada", puntos: 65},
            { fecha: parsearFecha("5 nov 2025, 11:27 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("4 nov 2025, 3:18 p. m."), concepto: "PayPal", puntos: -575 },
            { fecha: parsearFecha("4 nov 2025, 3:18 p. m."), concepto: "Encuesta pagada", puntos: 65},
            { fecha: parsearFecha("4 nov 2025, 3:11 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2},
            { fecha: parsearFecha("3 nov 2025, 10:20 p. m."), concepto: "Encuesta pagada", puntos: 40},
            { fecha: parsearFecha("3 nov 2025, 6:20 p. m."), concepto: "Encuesta pagada", puntos: 65},
            { fecha: parsearFecha("3 nov 2025, 5:43 p. m."), concepto: "Encuesta pagada", puntos: 40 },
            { fecha: parsearFecha("3 nov 2025, 5:37 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("3 nov 2025, 4:55 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("3 nov 2025, 12:23 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("3 nov 2025, 12:17 p. m."), concepto: "Encuesta pagada", puntos: 50 },
            { fecha: parsearFecha("3 nov 2025, 10:21 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("31 oct 2025, 10:49 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("27 oct 2025, 5:33 p. m."), concepto: "Encuesta pagada", puntos: 90 },
            { fecha: parsearFecha("27 oct 2025, 7:55 a. m."), concepto: "Encuesta pagada", puntos: 1 },
            { fecha: parsearFecha("26 oct 2025, 1:24 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("26 oct 2025, 9:53 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("25 oct 2025, 2:20 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("25 oct 2025, 2:17 p. m."), concepto: "PayPal", puntos: -575 },
            { fecha: parsearFecha("25 oct 2025, 2:17 p. m."), concepto: "Encuesta pagada", puntos: 40 },
            { fecha: parsearFecha("24 oct 2025, 4:41 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("23 oct 2025, 1:00 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("23 oct 2025, 12:39 p. m."), concepto: "Encuesta pagada", puntos: 90 },
            { fecha: parsearFecha("23 oct 2025, 12:26 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("22 oct 2025, 10:17 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("22 oct 2025, 12:33 a. m."), concepto: "Encuesta pagada", puntos: 90 },
            { fecha: parsearFecha("20 oct 2025, 1:56 p. m."), concepto: "Encuesta pagada", puntos: 1 },
            { fecha: parsearFecha("20 oct 2025, 12:34 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("18 oct 2025, 11:00 a. m."), concepto: "Encuesta pagada", puntos: 40 },
            { fecha: parsearFecha("16 oct 2025, 12:25 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("16 oct 2025, 12:21 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("15 oct 2025, 5:29 p. m."), concepto: "Ayúdanos a encontrarte encuestas", puntos: 2 },
            { fecha: parsearFecha("14 oct 2025, 5:05 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("14 oct 2025, 5:03 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("10 oct 2025, 12:32 a. m."), concepto: "Encuesta pagada", puntos: 40 },
            { fecha: parsearFecha("9 oct 2025, 5:43 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("9 oct 2025, 2:42 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("9 oct 2025, 12:30 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("9 oct 2025, 1:54 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("8 oct 2025, 10:33 p. m."), concepto: "Ayúdanos a encontrarte encuestas", puntos: 1 },
            { fecha: parsearFecha("8 oct 2025, 4:58 p. m."), concepto: "Encuesta pagada", puntos: 40 },
            { fecha: parsearFecha("7 oct 2025, 3:14 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("7 oct 2025, 3:08 p. m."), concepto: "Encuesta pagada", puntos: 25 },
            { fecha: parsearFecha("7 oct 2025, 3:01 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("6 oct 2025, 4:44 p. m."), concepto: "PayPal", puntos: -575 },
            { fecha: parsearFecha("6 oct 2025, 4:44 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("6 oct 2025, 3:58 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("6 oct 2025, 12:31 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("6 oct 2025, 8:06 a. m."), concepto: "Encuesta pagada", puntos: 50 },
            { fecha: parsearFecha("5 oct 2025, 10:44 a. m."), concepto: "Encuesta pagada", puntos: 40 },
            { fecha: parsearFecha("3 oct 2025, 11:09 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("3 oct 2025, 8:37 a. m."), concepto: "Encuesta pagada", puntos: 90 },
            { fecha: parsearFecha("3 oct 2025, 12:20 a. m."), concepto: "Encuesta pagada", puntos: 90 },
            { fecha: parsearFecha("2 oct 2025, 5:00 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("2 oct 2025, 3:49 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("2 oct 2025, 3:40 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("1 oct 2025, 9:11 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("1 oct 2025, 3:49 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("30 sept 2025, 7:21 p. m."), concepto: "Encuesta pagada", puntos: 40 },
            { fecha: parsearFecha("30 sept 2025, 3:48 p. m."), concepto: "PayPal", puntos: -575 },
            { fecha: parsearFecha("30 sept 2025, 3:08 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("30 sept 2025, 11:22 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("30 sept 2025, 12:30 a. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("29 sept 2025, 4:39 p. m."), concepto: "Encuesta pagada", puntos: 90 },
            { fecha: parsearFecha("27 sept 2025, 5:31 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("26 sept 2025, 3:50 p. m."), concepto: "Encuesta pagada", puntos: 10 },
            { fecha: parsearFecha("26 sept 2025, 9:10 a. m."), concepto: "Encuesta pagada", puntos: 40 },
            { fecha: parsearFecha("26 sept 2025, 1:49 a. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("25 sept 2025, 11:18 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("25 sept 2025, 11:16 a. m."), concepto: "Encuesta pagada", puntos: 90 },
            { fecha: parsearFecha("25 sept 2025, 10:38 a. m."), concepto: "Encuesta pagada", puntos: 1 },
            { fecha: parsearFecha("24 sept 2025, 9:25 p. m."), concepto: "PayPal", puntos: -575 },
            { fecha: parsearFecha("24 sept 2025, 9:24 p. m."), concepto: "Encuesta pagada", puntos: 250 },
            { fecha: parsearFecha("24 sept 2025, 2:17 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("24 sept 2025, 1:01 p. m."), concepto: "Encuesta pagada", puntos: 90 },
            { fecha: parsearFecha("22 sept 2025, 6:58 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("22 sept 2025, 10:12 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("20 sept 2025, 1:46 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("20 sept 2025, 10:56 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("17 sept 2025, 7:01 p. m."), concepto: "Encuesta pagada", puntos: 90 },
            { fecha: parsearFecha("17 sept 2025, 2:52 p. m."), concepto: "Encuesta pagada", puntos: 1 },
            { fecha: parsearFecha("17 sept 2025, 2:52 p. m."), concepto: "Encuesta pagada", puntos: 1 },
            { fecha: parsearFecha("16 sept 2025, 11:05 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("16 sept 2025, 11:03 a. m."), concepto: "Ayúdanos a encontrarte encuestas", puntos: 1 },
            { fecha: parsearFecha("15 sept 2025, 2:23 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("15 sept 2025, 10:53 a. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("14 sept 2025, 10:36 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("13 sept 2025, 1:17 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("13 sept 2025, 1:15 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("11 sept 2025, 12:36 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("11 sept 2025, 12:30 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("10 sept 2025, 2:15 p. m."), concepto: "PayPal", puntos: -575 },
            { fecha: parsearFecha("10 sept 2025, 2:15 p. m."), concepto: "Encuesta pagada", puntos: 140 },
            { fecha: parsearFecha("9 sept 2025, 5:30 p. m."), concepto: "Encuesta pagada", puntos: 25 },
            { fecha: parsearFecha("9 sept 2025, 5:28 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("9 sept 2025, 5:27 p. m."), concepto: "Encuesta pagada", puntos: 1 },
            { fecha: parsearFecha("9 sept 2025, 3:23 p. m."), concepto: "Encuesta pagada", puntos: 90 },
            { fecha: parsearFecha("9 sept 2025, 1:12 p. m."), concepto: "Encuesta pagada", puntos: 40 },
            { fecha: parsearFecha("9 sept 2025, 1:10 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("9 sept 2025, 12:58 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("9 sept 2025, 12:56 p. m."), concepto: "Encuesta pagada", puntos: 140 },
            { fecha: parsearFecha("8 sept 2025, 6:47 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("8 sept 2025, 6:10 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("6 sept 2025, 8:05 p. m."), concepto: "PayPal", puntos: -575 },
            { fecha: parsearFecha("6 sept 2025, 8:05 p. m."), concepto: "Encuesta pagada", puntos: 140 },
            { fecha: parsearFecha("6 sept 2025, 12:09 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("6 sept 2025, 12:05 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("3 sept 2025, 11:18 p. m."), concepto: "PayPal", puntos: -575 },
            { fecha: parsearFecha("3 sept 2025, 5:26 p. m."), concepto: "Encuesta pagada", puntos: 580 },
            { fecha: parsearFecha("2 sept 2025, 7:52 p. m."), concepto: "Encuesta pagada", puntos: 10 },
            { fecha: parsearFecha("2 sept 2025, 7:51 p. m."), concepto: "Encuesta pagada", puntos: 10 },
            { fecha: parsearFecha("2 sept 2025, 7:50 p. m."), concepto: "Encuesta pagada", puntos: 10 },
            { fecha: parsearFecha("30 ago 2025, 12:44 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("30 ago 2025, 12:40 a. m."), concepto: "Ayúdanos a encontrarte encuestas", puntos: 1 },
            { fecha: parsearFecha("27 ago 2025, 7:42 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("24 ago 2025, 1:53 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("22 ago 2025, 11:43 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("22 ago 2025, 11:42 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("22 ago 2025, 4:43 a. m."), concepto: "Ayúdanos a encontrarte encuestas", puntos: 1 },
            { fecha: parsearFecha("22 ago 2025, 2:23 a. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("21 ago 2025, 8:05 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("21 ago 2025, 8:01 p. m."), concepto: "Encuesta pagada", puntos: 140 },
            { fecha: parsearFecha("1 ago 2025, 6:27 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("7 jul 2025, 4:11 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("5 jul 2025, 2:17 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("4 jul 2025, 6:31 p. m."), concepto: "Encuesta pagada", puntos: 40 },
            { fecha: parsearFecha("4 jul 2025, 4:20 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("4 jul 2025, 11:51 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("4 jul 2025, 9:46 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("3 jul 2025, 10:52 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("3 jul 2025, 5:51 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("3 jul 2025, 5:49 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("3 jul 2025, 4:48 p. m."), concepto: "Encuesta pagada", puntos: 90 },
            { fecha: parsearFecha("3 jul 2025, 4:37 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("30 jun 2025, 11:30 a. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("29 jun 2025, 4:01 p. m."), concepto: "PayPal", puntos: -575 },
            { fecha: parsearFecha("29 jun 2025, 2:55 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("28 jun 2025, 1:25 a. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("28 jun 2025, 12:52 a. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("28 jun 2025, 12:06 a. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("26 jun 2025, 10:41 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("26 jun 2025, 10:40 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("26 jun 2025, 6:18 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("26 jun 2025, 6:16 p. m."), concepto: "Encuesta pagada", puntos: 90 },
            { fecha: parsearFecha("25 jun 2025, 9:49 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("24 jun 2025, 2:27 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("24 jun 2025, 2:26 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("24 jun 2025, 2:25 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("24 jun 2025, 2:23 p. m."), concepto: "Ayúdanos a encontrarte encuestas", puntos: 1 },
            { fecha: parsearFecha("24 jun 2025, 2:08 p. m."), concepto: "Encuesta pagada", puntos: 65 },
            { fecha: parsearFecha("24 jun 2025, 1:59 p. m."), concepto: "Bonificación por no cumplir los requisitos", puntos: 2 },
            { fecha: parsearFecha("24 jun 2025, 1:56 p. m."), concepto: "Encuesta pagada", puntos: 90 },
            { fecha: parsearFecha("24 jun 2025, 1:19 p. m."), concepto: "Ayúdanos a encontrarte encuestas", puntos: 79 },
            { fecha: parsearFecha("24 jun 2025, 1:15 p. m."), concepto: "Tu regalo de bienvenida", puntos: 10 }
        ];

        // Procesar datos
        function procesarDatos() {
            // Ordenar por fecha (más reciente primero)
            historial.sort((a, b) => {
                return b.fecha - a.fecha;
            });
            
            // Calcular totales
            let totalLifepoints = 0;
            let totalWithdrawn = 0;
            let currentBalance = 0;
            
            historial.forEach(transaccion => {
                totalLifepoints += Math.max(0, transaccion.puntos);
                if (transaccion.puntos < 0) {
                    totalWithdrawn += Math.abs(transaccion.puntos);
                }
                currentBalance += transaccion.puntos;
            });
            
            // Actualizar resumen
            document.getElementById('total-lifepoints').textContent = totalLifepoints.toLocaleString();
            document.getElementById('total-euros').textContent = (totalLifepoints / 115).toFixed(2);
            
            document.getElementById('current-lifepoints').textContent = currentBalance.toLocaleString();
            document.getElementById('current-euros').textContent = (currentBalance / 115).toFixed(2);
            
            document.getElementById('withdrawn-lifepoints').textContent = totalWithdrawn.toLocaleString();
            document.getElementById('withdrawn-euros').textContent = (totalWithdrawn / 115).toFixed(2);
            
            // Crear resumen mensual
            const resumenMensual = {};
            historial.forEach(transaccion => {
                if (transaccion.puntos > 0) {
                    const fecha = transaccion.fecha;
                    const mesAnio = `${fecha.getMonth() + 1}/${fecha.getFullYear()}`;
                    
                    if (!resumenMensual[mesAnio]) {
                        resumenMensual[mesAnio] = 0;
                    }
                    
                    resumenMensual[mesAnio] += transaccion.puntos;
                }
            });
            
            // Llenar tabla de resumen mensual
            const tablaBody = document.querySelector('#monthly-summary tbody');
            for (const [mes, puntos] of Object.entries(resumenMensual)) {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${mes}</td>
                    <td>${puntos.toLocaleString()}</td>
                    <td>${(puntos / 115).toFixed(2)} €</td>
                `;
                tablaBody.appendChild(fila);
            }
            
            // Preparar datos para la gráfica
            const datosGrafica = [];
            let acumulado = 0;
            
            // Ordenar por fecha (más antigua primero)
            const historialOrdenado = [...historial].sort((a, b) => a.fecha - b.fecha);
            
            historialOrdenado.forEach(transaccion => {
                acumulado += transaccion.puntos;
                datosGrafica.push({
                    fecha: transaccion.fecha,
                    puntos: acumulado
                });
            });
            
            // Crear gráfica
            const ctx = document.getElementById('lifepointsChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: datosGrafica.map(d => {
                        const fecha = d.fecha;
                        return `${fecha.getDate()}/${fecha.getMonth() + 1}/${fecha.getFullYear()}`;
                    }),
                    datasets: [{
                        label: 'Lifepoints Acumulados',
                        data: datosGrafica.map(d => d.puntos),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Lifepoints'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Fecha'
                            },
                            ticks: {
                                maxTicksLimit: 10
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Lifepoints: ${context.parsed.y.toLocaleString()}`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Análisis de horarios de encuestas
            analizarHorariosEncuestas();
        }

        // Función para analizar los horarios de encuestas
        function analizarHorariosEncuestas() {
            // Filtrar solo las encuestas pagadas
            const encuestas = historial.filter(t => 
                t.concepto === "Encuesta pagada" && t.puntos > 0
            );
            
            // Analizar por día de la semana y hora del día
            const actividadPorDia = Array(7).fill(0); // 0=Domingo, 1=Lunes, ..., 6=Sábado
            const actividadPorHora = Array(24).fill(0); // 0-23 horas
            
            encuestas.forEach(encuesta => {
                const dia = encuesta.fecha.getDay(); // 0=Domingo, 1=Lunes, ..., 6=Sábado
                const hora = encuesta.fecha.getHours();
                
                actividadPorDia[dia]++;
                actividadPorHora[hora]++;
            });
            
            // Encontrar los días y horas con más actividad
            const maxActividadDia = Math.max(...actividadPorDia);
            const maxActividadHora = Math.max(...actividadPorHora);
            
            // Crear la cuadrícula de horarios
            const diasSemana = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
            const horasDia = Array.from({length: 24}, (_, i) => i);
            
            const scheduleGrid = document.getElementById('schedule-grid');
            
            // Crear encabezados
            scheduleGrid.innerHTML = '<div class="schedule-header">Hora/Día</div>';
            diasSemana.forEach(dia => {
                scheduleGrid.innerHTML += `<div class="schedule-header">${dia}</div>`;
            });
            
            // Crear filas para cada hora
            horasDia.forEach(hora => {
                // Formatear hora para mostrar en formato 12 horas
                const horaFormateada = hora === 0 ? '12 a.m.' : 
                                     hora < 12 ? `${hora} a.m.` :
                                     hora === 12 ? '12 p.m.' : 
                                     `${hora - 12} p.m.`;
                
                scheduleGrid.innerHTML += `<div class="schedule-header">${horaFormateada}</div>`;
                
                diasSemana.forEach((_, diaIndex) => {
                    // Contar encuestas para esta hora y día
                    const encuestasEnHorario = encuestas.filter(e => 
                        e.fecha.getDay() === diaIndex && e.fecha.getHours() === hora
                    ).length;
                    
                    let claseActividad = 'no-data';
                    if (encuestasEnHorario > 0) {
                        if (encuestasEnHorario >= 3) {
                            claseActividad = 'high-activity';
                        } else if (encuestasEnHorario >= 2) {
                            claseActividad = 'medium-activity';
                        } else {
                            claseActividad = 'low-activity';
                        }
                    }
                    
                    scheduleGrid.innerHTML += `
                        <div class="schedule-cell ${claseActividad}">
                            ${encuestasEnHorario > 0 ? encuestasEnHorario : ''}
                        </div>
                    `;
                });
            });
            
            // Generar recomendaciones
            generarRecomendaciones(actividadPorDia, actividadPorHora, diasSemana);
        }

        // Función para generar recomendaciones basadas en los datos
        function generarRecomendaciones(actividadPorDia, actividadPorHora, diasSemana) {
            const recommendationsList = document.getElementById('recommendations-list');
            
            // Encontrar los días con más actividad
            const maxActividadDia = Math.max(...actividadPorDia);
            const mejoresDias = actividadPorDia
                .map((actividad, index) => ({ dia: diasSemana[index], actividad }))
                .filter(item => item.actividad === maxActividadDia)
                .map(item => item.dia);
            
            // Encontrar las horas con más actividad
            const maxActividadHora = Math.max(...actividadPorHora);
            const mejoresHoras = actividadPorHora
                .map((actividad, index) => ({ hora: index, actividad }))
                .filter(item => item.actividad === maxActividadHora)
                .map(item => {
                    // Formatear hora para mostrar en formato 12 horas
                    const hora = item.hora;
                    return hora === 0 ? '12 a.m.' : 
                           hora < 12 ? `${hora} a.m.` :
                           hora === 12 ? '12 p.m.' : 
                           `${hora - 12} p.m.`;
                });
            
            // Generar recomendaciones
            let recomendacionesHTML = '';
            
            if (mejoresDias.length > 0) {
                recomendacionesHTML += `
                    <div class="recommendation-item">
                        Días con más encuestas: ${mejoresDias.join(', ')}.
                    </div>
                `;
            }
            
            if (mejoresHoras.length > 0) {
                recomendacionesHTML += `
                    <div class="recommendation-item">
                        Hora con más encuestas: ${mejoresHoras.join(', ')}
                    </div>
                `;
            }
            
            // Recomendación general basada en el total de encuestas
            const totalEncuestas = historial.filter(t => 
                t.concepto === "Encuesta pagada" && t.puntos > 0
            ).length;
            
            if (totalEncuestas > 50) {
                recomendacionesHTML += `
                    <div class="recommendation-item">
                    Considera establecer horarios fijos para revisar la plataforma.
                    </div>
                `;
            } else {
                recomendacionesHTML += `
                    <div class="recommendation-item">
                    Cuantas mas encuestas realizadas el análisis será mas precisa.
                    </div>
                `;
            }
            
            // Recomendación sobre días laborables vs fines de semana
            const actividadLaborables = actividadPorDia.slice(1, 6).reduce((a, b) => a + b, 0);
            const actividadFinSemana = actividadPorDia[0] + actividadPorDia[6];
            
            if (actividadLaborables > actividadFinSemana * 2) {
                recomendacionesHTML += `
                    <div class="recommendation-item">
                        Hay muchas más encuestas durante los días laborables.
                    </div>
                `;
            } else if (actividadFinSemana > actividadLaborables) {
                recomendacionesHTML += `
                    <div class="recommendation-item">
                        Hay mucha más actividad durante los fines de semana.
                    </div>
                `;
            }
            
            recommendationsList.innerHTML = recomendacionesHTML;
        }

        // Inicializar cuando se carga la página
        window.onload = procesarDatos;
    </script>
</body>
</html>
